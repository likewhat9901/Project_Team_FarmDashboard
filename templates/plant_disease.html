<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‹ë¬¼ ë³‘ ê°ì§€</title>
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ìƒëµ ê°€ëŠ¥) */
    @font-face {
      font-family: 'GmarketSansMedium';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      font-family: 'GmarketSansMedium', sans-serif;
      background: #f0f4f2;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }
    .fruit-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 40px;
    }
    .fruit-btn {
      background-color: #81c784;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .fruit-btn:hover {
      background-color: #66bb6a;
    }
    .fruit-btn.selected {
      background-color: #4caf50;
    }
    .sidebar {
      width: 220px;
      background: linear-gradient(135deg, #81c784 0%, #a5d6a7 30%, #c8e6c9 70%, #81c784 100%);
      padding: 20px;
      border-radius: 20px;
      margin: 20px;
      height: calc(100vh - 40px);
      position: relative;
      box-shadow: 0 15px 35px rgba(76, 175, 80, 0.3), 0 5px 15px rgba(76, 175, 80, 0.2);
      display: flex;
      flex-direction: column;
    }
    .logo {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
    }
    .logo-icon {
      width: 30px;
      height: 30px;
      background: linear-gradient(135deg, #66bb6a 0%, #81c784 100%);
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    .logo-icon::before {
      content: 'âš¡';
      color: white;
      font-size: 18px;
    }
    .logo h2 {
      color: #333;
      font-size: 16px;
      font-weight: 600;
    }
    .nav-menu {
      list-style: none;
      flex-grow: 1;
    }
    .nav-item {
      margin-bottom: 8px;
    }
    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 25px;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 600;
    }
    .nav-link.active {
      background: rgba(255, 255, 255, 0.5);
      color: #333;
      font-weight: bold;
    }
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .nav-icon {
      margin-right: 12px;
      font-size: 16px;
    }
    .bottom-controls {
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.3);
      padding-top: 15px;
      gap: 10px;
    }
    .toggle-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: white;
      font-size: 14px;
    }
    .toggle-switch {
      width: 40px;
      height: 20px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      position: relative;
      cursor: pointer;
    }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      top: 2px;
      right: 2px;
      transition: all 0.5s ease;
    }
    .toggle-switch.active::after {
      transform: translateX(-20px);
    }
    .withdraw-btn {
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      font-size: 14px;
      margin: 10px 0;
    }
    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      width: 100%;
    }
    .main-content {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
    }
    .main-title {
      font-size: 28px;
      font-weight: bold;
      color: #1b5e20;
      margin-bottom: 40px;
      text-align: center;
    }
    .detector-layout {
      display: flex;
      gap: 40px;
      justify-content: center;
      align-items: flex-start;
    }
    .box {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      width: 360px;
    }
    .box h2 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #388e3c;
      text-align: center;
    }
    input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #81c784;
      border-radius: 8px;
      background: #e8f5e9;
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .preview {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 10px;
      display: none;
      margin-bottom: 20px;
    }
    .result-text {
      text-align: center;
      font-size: 16px;
      font-weight: bold;
    }
    .disease-positive {
      color: #d32f2f;
    }
    .disease-negative {
      color: #388e3c;
    }
    .detector-layout {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 30px;
    }
    .box {
      width: 400px;
      height: 500px;
      background: white;
      border-radius: 20px;
      padding: 30px 40px;
      box-shadow: 0 15px 35px rgba(76, 175, 80, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
  </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="logo">
    <div class="logo-icon"></div>
    <h2>Logo Here</h2>
  </div>
  <ul class="nav-menu">
    <li class="nav-item"><a href="#" class="nav-link active"><span class="nav-icon">ğŸ </span> Dashboard</a></li>
    <li class="nav-item"><a href="#" class="nav-link" onclick="location.href='/map'"><span class="nav-icon">ğŸ«</span> ë†ì—…êµìœ¡ê¸°ê´€</a></li>
    <li class="nav-item"><a href="#" class="nav-link" onclick="location.href='/flowershop'"><span class="nav-icon">ğŸŒ¼</span> ê½ƒì§‘ ì§€ë„</a></li>
    <li class="nav-item"><a href="#" class="nav-link"><span class="nav-icon">âš™ï¸</span> Setting</a></li>
    <li class="nav-item"><a href="#" class="nav-link"><span class="nav-icon">ğŸ”’</span> Privacy</a></li>
  </ul>
  <div class="bottom-controls">
    <div class="toggle-control"><span>ğŸŒ™ Light Mode</span><div class="toggle-switch"></div></div>
    <a href="#" class="withdraw-btn"><span>ğŸ’° Withdraw</span></a>
    <button class="logout-btn">ğŸ“¤ Logout</button>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <h1 class="main-title">ì‹ë¬¼ ë³‘ ê°ì§€ê¸°</h1>

  <!-- ê³¼ì¼ ë²„íŠ¼ -->
  <div class="fruit-buttons">
    <button class="fruit-btn" data-fruit="ê·¤">ê·¤</button>
    <button class="fruit-btn" data-fruit="ë”¸ê¸°">ë”¸ê¸°</button>
    <button class="fruit-btn" data-fruit="ë ˆëª¬">ë ˆëª¬</button>
    <button class="fruit-btn" data-fruit="ì°¸ì™¸">ì°¸ì™¸</button>
  </div>

  <div class="detector-layout">
    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
    <div class="box">
      <h2>ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
      <input type="file" accept="image/*" id="upload" />
      <img id="preview" class="preview" alt="ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°" />
      <div id="result" class="result"></div>
    </div>

    <!-- ì§„ë‹¨ ê²°ê³¼ -->
    <div class="box">
      <h2>ì§„ë‹¨ ê²°ê³¼</h2>
      <p id="diagnosis-message" class="result-text">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>
  </div>
</div>

<script>
  const fruitButtons = document.querySelectorAll('.fruit-btn');
  const uploadInput = document.getElementById('upload');
  const previewImg = document.getElementById('preview');
  const resultDiv = document.getElementById('result');
  const diagnosisMessage = document.getElementById('diagnosis-message');

  let selectedFruit = null;

  // ê³¼ì¼ ë²„íŠ¼ í´ë¦­ ì‹œ ì„ íƒ í‘œì‹œ ë° ê°’ ì €ì¥
  fruitButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      fruitButtons.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedFruit = btn.getAttribute('data-fruit');
      diagnosisMessage.textContent = `${selectedFruit}ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.`;
      previewImg.style.display = 'none';
      resultDiv.textContent = '';
      uploadInput.value = ''; // ì„ íƒ ì´ˆê¸°í™”
    });
  });

  uploadInput.addEventListener('change', async e => {
    if (!selectedFruit) {
      alert('ë¨¼ì € ê³¼ì¼ì„ ì„ íƒí•˜ì„¸ìš”!');
      uploadInput.value = '';
      return;
    }

    const file = e.target.files[0];
    if (!file) {
      previewImg.style.display = 'none';
      resultDiv.textContent = '';
      diagnosisMessage.textContent = 'ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
      return;
    }

    // ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
    const reader = new FileReader();
    reader.onload = () => {
      previewImg.src = reader.result;
      previewImg.style.display = 'block';
    };
    reader.readAsDataURL(file);

    // ì„œë²„ë¡œ ì´ë¯¸ì§€ + ê³¼ì¼ ì´ë¦„ ì „ì†¡
    const formData = new FormData();
    formData.append('fruit', selectedFruit);
    formData.append('image', file);

    diagnosisMessage.textContent = 'ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.';

    try {
      const response = await fetch('/predict', {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        throw new Error('ì„œë²„ ì—ëŸ¬ ë°œìƒ');
      }

      const data = await response.json();

      if (data.error) {
        diagnosisMessage.textContent = data.error;
        resultDiv.textContent = '';
      } else {
        // ê²°ê³¼ ì¶œë ¥
        diagnosisMessage.textContent = `ë³‘ëª…: ${data.disease}`;
        resultDiv.innerHTML = `ì‹ ë¢°ë„: ${(data.confidence * 100).toFixed(2)}%`;
      }

    } catch (err) {
      diagnosisMessage.textContent = 'ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      resultDiv.textContent = '';
      console.error(err);
    }
  });
</script>

</body>
</html>
